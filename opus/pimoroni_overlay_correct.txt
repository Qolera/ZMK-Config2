/*
 * Copyright (c) 2024
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/led/led.h>

// ========================================
// CONFIGURACIÓN PINES I2C
// ========================================
&pinctrl {
    // SPI para RGB LEDs (existente)
    spi3_default: spi3_default {
        group1 {
            psels = <NRF_PSEL(SPIM_MOSI, 0, 6)>;
        };
    };
    
    spi3_sleep: spi3_sleep {
        group1 {
            psels = <NRF_PSEL(SPIM_MOSI, 0, 6)>;
            low-power-enable;
        };
    };
    
    // I2C para Pimoroni Trackball
    i2c0_default: i2c0_default {
        group1 {
            psels = <NRF_PSEL(TWIM_SDA, 0, 17)>,
                    <NRF_PSEL(TWIM_SCL, 0, 20)>;
            bias-pull-up;
        };
    };
    
    i2c0_sleep: i2c0_sleep {
        group1 {
            psels = <NRF_PSEL(TWIM_SDA, 0, 17)>,
                    <NRF_PSEL(TWIM_SCL, 0, 20)>;
            low-power-enable;
            bias-pull-up;
        };
    };
};

// ========================================
// CONFIGURACIÓN RGB LED (existente)
// ========================================
&spi3 {
    compatible = "nordic,nrf-spim";
    status = "okay";
    pinctrl-0 = <&spi3_default>;
    pinctrl-1 = <&spi3_sleep>;
    pinctrl-names = "default", "sleep";
    
    led_strip: ws2812@0 {
        compatible = "worldsemi,ws2812-spi";
        label = "WS2812";
        reg = <0>;
        spi-max-frequency = <4000000>;
        chain-length = <29>;
        spi-one-frame = <0x70>;
        spi-zero-frame = <0x40>;
        color-mapping = <LED_COLOR_ID_GREEN
                        LED_COLOR_ID_RED
                        LED_COLOR_ID_BLUE>;
    };
};

// ========================================
// CONFIGURACIÓN I2C Y PIMORONI TRACKBALL
// ========================================
&i2c0 {
    compatible = "nordic,nrf-twim";
    status = "okay";
    pinctrl-0 = <&i2c0_default>;
    pinctrl-1 = <&i2c0_sleep>;
    pinctrl-names = "default", "sleep";
    
    // Importante: velocidad máxima 250kHz para el Pimoroni
    clock-frequency = <250000>;
    
    pim447_trackball: pim447@a {
        compatible = "pimoroni,pim447";
        reg = <0x0a>;
        label = "PIM447_TRACKBALL";
        
        // Pin de interrupción (opcional, ajusta según tu conexión)
        // Si no usas interrupciones, comenta esta línea
        // int-gpios = <&gpio0 8 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };
};

// ========================================
// CONFIGURACIÓN GLOBAL
// ========================================
/ {
    chosen {
        zmk,underglow = &led_strip;
    };
};